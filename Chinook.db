#Question 1: Which countries have the most Invoices?

select count(total) invoices, BillingCountry from invoice
group by BillingCountry
order by invoices DESC;

#Question 2: Which city has the best customers?

select sum(total) total_invoice, BillingCity from invoice
group by BillingCity
order by invoices DESC
limit 1;

#Question 3: Who is the best customer?

select c.CustomerID, sum(il.UnitPrice * il.Quantity) total_money_spent
from Customer c JOIN Invoice i 
ON c.CustomerId = i.CustomerID 
JOIN InvoiceLine il
ON i.InvoiceID = il.InvoiceID
Group by 1
ORDER by 2 desc
LIMIT 1;

#Q1 Set 2: 
#Use your query to return the email, first name, last name, and Genre of all Rock Music listeners. 
#Return your list ordered alphabetically by email address starting with A. 
#Can you find a way to deal with duplicate email addresses so no one receives multiple emails?

select c.firstname, c.lastname, c.email, g.name 
from Genre g
join track t
on t.GenreId = g.GenreId
join InvoiceLine l
on t.TrackId = l.TrackId
join Invoice i
on i.InvoiceId = l.Invoiceid
join Customer c
on i.CustomerId = c.CustomerId
WHERE g.name = "Rock"
group by c.email 
Order by c.email asc;

#Q2 Set 2:
#Let's invite the artists who have written the most rock music in our dataset. 
#Write a query that returns the Artist name and total track count of the top 10 rock bands.

select at.ArtistID, at.Name, count(t.name) songs
from genre g
join Track t
on g.genreid = t.genreid
join Album a
on t.albumid = a.albumid
join artist at
on a.artistid = at.artistid
where g.name = "Rock"
group by 2
order by 3 desc
limit 10;

#Q2 Set 2
#First, find which artist has earned the most according to the InvoiceLines?
#Now use this artist to find which customer spent the most on this artist.

select ar.name, sum(il.quantity*il.unitprice) AmountSpent, c.customerid, c.firstname, c.lastname
from Artist ar join Album a
on ar.Artistid = a.Artistid
join track t
on t.albumid = a.albumid
join InvoiceLine il
on t.TrackId = il.Trackid JOIN Invoice i 
on c.CustomerId = i.CustomerId 
WHERE ar.Name = 'Iron Maiden' 
GROUP BY c.CustomerId 
ORDER BY AmountSpent DESC;
